
\subsection{General convection--diffusion equation}

Let $\cv{} \subset \real^n$ be a control volume which may depend on time $t \in I \subset \real$ and let
$\phi \colon \real^n \times I \to \real$, $(x, t) \mapsto \phi(x, t)$
be a magnitude of the fluid (such as the concentration of some chemical
substance) per unit of mass. Then the total ammount of $\phi$ in $\cvt$ is
\begin{equation}
	\Phi(t) = 
	\int_{\cvt} \rho(x, t) \phi(x, t) \dd{x}
\end{equation}
and its variation over time is
\begin{equation} \label{eq:general_cde_variation_Phi}
	\dot{\Phi}(t) =
	\frac{\dd}{\dd t} \Phi(t) = 
	\frac{\dd}{\dd{t}} \int_{\cvt} \rho(x, t) \phi(x, t) \dd{x}
\end{equation}
The variation of $\Phi$ is a consequence of two contributions: the flux of
$\phi$ through the control surface $\cst$ and the generation/elimination of
$\phi$ in $\cvt$ due to source terms. Let $\vb{f} \colon \real \times \cs{}
\times I \rightarrow \real^n$, $(\phi, x, t) \mapsto \vb{f}(\phi, x,
t)$ be the vector field which gives the flux of $\phi$ through $\cs{}$. Then the
total ammount of $\phi$ flowing through $\cst$ is given by
\begin{equation}
	\mathscr{F}(t) = \int_{\cst} \vb{f}(\phi, x, t) \vdot \vb{n} \dd{S}
\end{equation}
In order to find out which sign has $\mathscr{F}(t)$, we may assume for a moment
that there are no source terms. If $\mathscr{F}(t) > 0$, then $\phi$ is exiting
$\cvt$ and, as a result, $\dot{\Phi}(t) < 0$. Conversely, if $\mathscr{F}(t) <
0$, then $\dot{\Phi}(t) > 0$, therefore $\dot{\Phi}(t)$ and $F(t)$ have opposite
signs. Now, let $\dot{s}_\phi \colon \rightarrow \real$ be te source term, which
provides the ammount of $\phi$ generated/eliminated in $\cvt$ per unit of time.
Then the total ammount of $\phi$ generated/eliminated in $\cvt$ is
\begin{equation}
	\mathscr{S}(t) = \int_{\cvt} \dot{s}_\phi (\phi, x, t) \dd{x}
\end{equation}
Assume that there is no flux of $\phi$ through $\cst$, that is to say,
$\mathscr{F}(t) = 0$. If $\phi$ is generated in $\cvt$, then $\mathscr{S}(t) >
0$, which implies $\dot{\phi}(t) > 0$; whereas if $\mathscr{S}(t) < 0$ then
$\dot{\phi}(t) > 0$, thus $\dot{\phi}(t)$ and $\mathscr{S}(t)$ have the same
sign. Introducing these terms in \eqref{eq:general_cde_variation_Phi} leads to
\begin{equation} \label{eq:general_cde_1}
	\frac{\dd}{\dd{t}} \int_{\cvt} \rho(x, t) \phi(x, t) \dd{x} = 
	- \int_{\cst} \vb{f}(\phi, x, t) \vdot \vb{n} \dd{S} 
	+ \int_{\cvt} \dot{s}_\phi (\phi, x, t) \dd{x}	
\end{equation}
Hereinafter we shall become less formal by omitting on which variables depends
each function. In order to relate the flux $\vb{f}$ and $\phi$, we need to apply
some constitutive law. Fourier's law for heat conduction and Fick's law for
concentration state that $\vb{f}$ depends linearly on the gradient of $\phi$
with respect to the spatial variables, that is,
\begin{equation} \label{eq:general_cde_flux_term_gradient_phi}
	\vb{f} = 
	-\Gamma_\phi \grad_{x} \phi = 
	-\Gamma_\phi
	\begin{pmatrix}
		\displaystyle\pdv{\phi}{x_1} & \cdots & \displaystyle\pdv{\phi}{x_n}
	\end{pmatrix}^T
\end{equation}
where $\Gamma_\phi$ is known as the diffusion coefficient. So as not to
complicate the notation, we will write $\grad{\phi}$ in place of $\grad_{x}
\phi$. Recall that $\grad{\phi} \in \real^n$ gives the direction of maximum
growth of $\phi(\cdot, t)$ (the time is fixed because the gradient is computed
with respect to $x$). The minus sign in
\eqref{eq:general_cde_flux_term_gradient_phi} is the consequence of heat
(concentration of a chemical) flowing from regions of higher to lower
temperature (concentration) regions. With this in mind, equation
\eqref{eq:general_cde_1} is rewritten as
\begin{equation} \label{eq:general_cde_2}
	\frac{\dd}{\dd{t}} \int_{\cvt} \rho \phi \dd{x} = 
	\int_{\cst} \Gamma_\phi \grad{\phi} \vdot \vb{n} \dd{S} +
	\int_{\cvt} \dot{s}_\phi \dd{x}	
\end{equation}
and applying Reynolds Transport Theorem on the left--hand side of
\eqref{eq:general_cde_2} with $\vb{b} = \vb{v}$,
\begin{equation}
	\int_{\cvt} \pdv{(\rho \phi)}{t} \dd{x} + 
	\int_{\cst} \rho \phi \vb{v} \vdot \vb{n} \dd{S} = 
	\int_{\cst} \Gamma_\phi \grad{\phi} \vdot \vb{n} \dd{S} +
	\int_{\cvt} \dot{s}_\phi \dd{x}	
\end{equation}
To turn surface integrals into volume integrals we apply divergence theorem,
\begin{equation}
	\int_{\cvt} \pdv{(\rho \phi)}{t} \dd{x} + 
	\int_{\cvt} \div(\rho \phi \vb{v}) \dd{x} = 
	\int_{\cvt} \div(\Gamma_\phi \grad{\phi}) \dd{x} + 
	\int_{\cvt} \dot{s}_\phi \dd{x}	
\end{equation}
Proceeding in a similar way to the continuity equation, we assume the existence
of a time $t_0$ and a point $x_0$ where
\begin{equation}
	\left.
	\left\{
	\pdv{(\rho \phi)}{t} \dd{x} + 
	\div(\rho \phi \vb{v}) \dd{x} - 
	\div(\Gamma_\phi \grad{\phi}) \dd{x} - 
	\dot{s}_\phi \dd{x}	
	\right\}
	\right\rvert_{(x_0,t_0)} \neq 0
\end{equation}
and we reach a contradiction, thereby obtaining the general convection diffusion
equation:
\begin{equation} \label{eq:general_cde_3}
	\pdv{(\rho \phi)}{t} + \div(\rho \phi \vb{v}) = 
	\div(\Gamma_\phi \grad{\phi}) + \dot{s}_\phi	
\end{equation}
The left--hand side of \eqref{eq:general_cde_3} can be expanded to find
\begin{equation} \label{eq:general_cde_4}
	\phi \left\{ \pdv{\rho}{t} + \div(\rho \vb{v}) \right\} + 
	\rho \pdv{\phi}{t} + \rho \vb{v} \cdot \grad{\phi} = 
	\div(\Gamma_\phi \grad{\phi}) + \dot{s}_\phi	
\end{equation}
Since the term between keys is the continuity equation, \eqref{eq:general_cde_4}
is simplified to
\begin{equation} \label{eq:cde_general_convection_diffusion_equation}
	\rho \pdv{\phi}{t} + \rho \vb{v} \cdot \grad{\phi} = 
	\div(\Gamma_\phi \grad{\phi}) + \dot{s}_\phi	
\end{equation}
Equations \eqref{eq:general_cde_3} and
\eqref{eq:cde_general_convection_diffusion_equation} are two equivalent forms of
the same equation, each having its applications and benefits.

By taking $\phi$ to be the temperature $T$ of the fluid or the concentration of
the $k$--th chemical substance $Y_k$ in the fluid, one obtains the energy
conservation equation \eqref{eq:cde_energy_equation} and the $k$--species
equation \eqref{eq:cde_species_equation} \cite{cttc_cde_2021}:
\begin{equation} \label{eq:cde_energy_equation}
	\pdv{(\rho T)}{t} + \div(\rho \vb{v} T) = 
	\div(\frac{\lambda}{c_v} \grad{T}) + 
	\left\{ \frac{\vb{\tau} \circ \grad{\vb{v}} - \div{\dot{\vb{q}}^R} - p \div{\vb{v}}}{c_v}\right\}
\end{equation}
\begin{equation} \label{eq:cde_species_equation}
	\pdv{(\rho Y_k)}{t} + \div(\rho \vb{v} Y_k) = 
	\div(\rho D_{km} \grad{Y_k}) + \left\{ \dot{\omega}_k \right\}
\end{equation}


If $\phi$ is not a scalar magnitude but a vector magnitude, \ie $\phi \equiv
(\phi_1, \ldots, \phi_n) \colon \real^n \times I \to \real^n$, $(x, t)
\mapsto \phi(x, t)$, the same process applied on each component function
$\phi_i$ leads to $n$ equations similar to \eqref{eq:general_cde_3} that can be
gathered in the following vector equation
\begin{equation}
	\pdv{(\rho \phi)}{t} + \div(\rho \vb{v} \otimes \phi) = 
	\div(\mu \grad{\phi}) + \dot{s}_\phi
\end{equation}
where $\vb{v} \otimes \phi$ is the exterior product:
\begin{equation}
	\vb{v} \otimes \phi =	
	\begin{pmatrix}
		v_1 \\ \vdots \\ v_n
	\end{pmatrix}
	\begin{pmatrix}
		\phi_1 & \cdots & \phi_n
	\end{pmatrix} = 
	\begin{pmatrix}
		v_1 \phi_1  & \cdots & v_1 \phi_n \\
		\vdots & \ddots & \vdots \\
		v_n \phi_1  & \cdots & v_n \phi_n
	\end{pmatrix}
\end{equation}

The previous product can also be regarded as the tensor product of two
$1$--covariant tensors which yields a $2$--covariant tensor. Notice that, in
general, this product is not commutative, that is to say, $\vb{v} \otimes \phi
\neq \phi \otimes \vb{v}$.

By taking $\phi$ to be the velocity $\vb{v}$ of the fluid, the momentum
conservation equation is obtained \cite{cttc_cde_2021}:
\begin{equation}
	\pdv{(\rho \vb{v})}{t} + \div(\rho \vb{v} \otimes \vb{v}) = 
	\div(\mu \grad{\vb{v}}) + \left\{ \div(\vb{\tau - \mu \grad{\vb{v}}}) - \grad{p} + \rho \vb{g} \right\}
\end{equation}



