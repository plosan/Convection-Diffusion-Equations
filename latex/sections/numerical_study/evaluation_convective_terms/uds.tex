\subsubsection{Upwind--Difference Scheme (UDS)}

Incompressible flows and gases at low Mach number are more influenced by
upstream conditions than downstream conditions. Let $(\vb{v} \vdot \vb{n})_e$
denote the value of the dot product $\vb{v} \vdot \vb{n}$ at east face
$\cs{Pe}$. If $(\vb{v} \vdot \vb{n})_e > 0$, fluid flows from node $P$ to node
$E$, hence $P$ is the upstream node and $E$ is the downstream node. Conversely,
if $(\vb{v} \vdot \vb{n})_e < 0$, nodes interchange their roles as fluid flows
from node $E$ to node $P$. Whenever $(\vb{v} \vdot \vb{n})_e = 0$, it implies
that $\vb{v}_e$ lies in the orthogonal subspace to the vector space generated by
$\vb{n}$. As a result, given the approximations taken, there is no fluid flow
through face $\cs{Pe}$.

% This situation is pictured in figures
% \ref{fig:uds_positive_dot_product} and \ref{fig:uds_negative_dot_product}.
% \begin{figure}[ht]
% 	\centering
% 	\begin{minipage}{.5\textwidth}
% 		\centering
% 		\begin{tikzpicture}
% 			% Fill
% 			\fill[black!20!white] (0,0) rectangle (6,2);
% 			% Nodes
% 			\filldraw[greenNode] (1.5,1) circle (2.5pt); \node[greenNode,
% 			yshift=0.3cm] at (1.5,1) {$P$}; \filldraw[greenNode] (4.5,1) circle
% 			(2.5pt); \node[greenNode, yshift=0.3cm] at (4.5,1) {$E$};
% 			% Vectors
% 			\draw[-latex, thick, blue!70!white, yshift=+0.5mm] (3,1) --
% 			node[above]{$\vb{n}$} ++(1,0); \draw[-latex, thick, red!70!white,
% 			yshift=-0.5mm] (3,1) -- node[below]{$\vb{v}$} ++(0.75,0);
% 			% Control volumes
% 			\draw[thick] (0,0) rectangle (6,2); \draw[thick] (3,0) -- ++(0,2);
% 			\node[circle, inner sep=0pt, outer sep=0pt, black, yshift=0.5cm,
% 			fill=black!20!white] at (3,0) {$\cs{Pe}$};
% 		\end{tikzpicture}
% 		\captionsetup{width=0.9\textwidth}
% 		\caption{Since $(\vb{v} \vdot \vb{n})_e > 0$ fluid flows from node $P$
% 		(upstream node) to node $E$ (downstream node).}
% 		\label{fig:uds_positive_dot_product}
% 	\end{minipage}%
% 	\begin{minipage}{.5\textwidth}
% 		\centering
% 		\begin{tikzpicture}
% 			% Fill
% 			\fill[black!20!white] (0,0) rectangle (6,2);
% 			% Nodes
% 			\filldraw[greenNode] (1.5,1) circle (2.5pt); \node[greenNode,
% 			yshift=0.3cm] at (1.5,1) {$P$}; \filldraw[greenNode] (4.5,1) circle
% 			(2.5pt); \node[greenNode, yshift=0.3cm] at (4.5,1) {$E$};			
% 			% Vectors
% 			\draw[-latex, thick, blue!70!white] (3,1) -- node[above]{$\vb{n}$}
% 			++(1,0); \draw[-latex, thick, red!70!white] (3,1) --
% 			node[above]{$\vb{v}$} ++(-0.75,0);			
% 			% Control volumes
% 			\draw[thick] (0,0) rectangle (6,2); \draw[thick] (3,0) -- ++(0,2);
% 			\node[circle, inner sep=0pt, outer sep=0pt, black, yshift=0.5cm,
% 			fill=black!20!white] at (3,0) {$\cs{Pe}$};
% 		\end{tikzpicture}
% 		\captionsetup{width=0.9\textwidth}
% 		\caption{Since $(\vb{v} \vdot \vb{n})_e < 0$ fluid flows from node $E$
% 		(upstream node) to node $P$ (downstream node).}
% 		\label{fig:uds_negative_dot_product}
% 	\end{minipage}
% \end{figure}

The Upwind--Difference Scheme assigns $\phi_e$ the value of $\phi$ at the
upstream node, that is,
\begin{equation} \label{eq:uds_e_initial}
	\phi_e = 
	\left\{
	\begin{aligned}
		&\phi_P & &\text{if } (\vb{v} \vdot \vb{n})_e > 0 \\
		&\phi_E & &\text{if } (\vb{v} \vdot \vb{n})_e < 0 \\
	\end{aligned}
	\right.
\end{equation}
The scheme is summarized in figures \ref{fig:uds_upstream_node_P} and
\ref{fig:uds_upstream_node_E}.
\begin{figure}[ht]
	\centering
	\begin{minipage}{.5\textwidth}
		\centering
		\begin{tikzpicture}
			% Ground
			\draw[thick] (0,0) -- ++(6,0);
			% Point P
			\filldraw[black] (0.5,0) circle (2pt); \draw[dashed] (0.5,0) --
			++(0,1.5); \node[black, yshift=-0.5cm] at (0.5,0) {$P$};
			\filldraw[sblue] (0.5,1.5) circle (2pt); \node[blue,
			yshift=0.5cm] at (0.5,1.5) {$\phi_P$};
			% Point e
			\filldraw[black] (2.5,0) circle (2pt); \draw[dashed] (2.5,0) --
			++(0,1.5); \node[black, yshift=-0.5cm] at (2.5,0) {$e$};
			\filldraw[sblue] (2.5,1.5) circle (2pt); \node[blue,
			yshift=0.5cm] at (2.5,1.5) {$\phi_e$}; 
			% Point E
			\filldraw[black] (5.5,0) circle (2pt); \draw[dashed] (5.5,0) --
			++(0,3); \node[black, yshift=-0.5cm] at (5.5,0) {$E$};
			\filldraw[sblue] (5.5,3.0) circle (2pt); \node[blue,
			yshift=0.5cm] at (5.5,3.0) {$\phi_E$};
			% Blue line
			\begin{scope}[very thick,decoration={markings, mark=at position 0.5
					with {\arrow{>}}}] \draw[thick, sblue,
					postaction={decorate}] (0.5,1.5) -- ++(2,0);
			\end{scope}
			% Mass flow
			\draw[-latex, red, thick] (1.75,0.75) -- ++(1.5,0)
			node[above]{$\dot{m}_e > 0$};
		\end{tikzpicture}
		\captionsetup{width=0.9\textwidth}
		\caption{UDS when $(\vb{v} \vdot \vb{n})_e > 0$.}
		\label{fig:uds_upstream_node_P}
	\end{minipage}%
	\begin{minipage}{.5\textwidth}
		\centering
		\begin{tikzpicture}
			% Ground
			\draw[thick] (0,0) -- ++(6,0);
			% Point P
			\filldraw[black] (0.5,0) circle (2pt); \draw[dashed] (0.5,0) --
			++(0,1.5); \node[black, yshift=-0.5cm] at (0.5,0) {$P$};
			\filldraw[sblue] (0.5,1.5) circle (2pt); \node[blue,
			yshift=0.5cm] at (0.5,1.5) {$\phi_P$};
			% Point e
			\filldraw[black] (2.5,0) circle (2pt); \draw[dashed] (2.5,0) --
			++(0,3); \node[black, yshift=-0.5cm] at (2.5,0) {$e$};
			\filldraw[sblue] (2.5,3) circle (2pt); \node[blue,
			yshift=0.5cm] at (2.5,3.0) {$\phi_e$}; 
			% Point E
			\filldraw[black] (5.5,0) circle (2pt); \draw[dashed] (5.5,0) --
			++(0,3); \node[black, yshift=-0.5cm] at (5.5,0) {$E$};
			\filldraw[sblue] (5.5,3) circle (2pt); \node[blue,
			yshift=0.5cm] at (5.5,3.0) {$\phi_e$}; 
			% Blue line
			\begin{scope}[very thick,decoration={markings, mark=at position 0.5
					with {\arrow{<}}}] \draw[thick, sblue,
					postaction={decorate}] (2.5,3.0) -- ++(3,0);
			\end{scope}
			% Mass flow
			\draw[-latex, red, thick] (1.75,0.75) -- ++(1.5,0)
			node[above]{$\dot{m}_e < 0$};
		\end{tikzpicture}
		\captionsetup{width=0.9\textwidth}
		\caption{UDS when $(\vb{v} \vdot \vb{n})_e < 0$.}
		\label{fig:uds_upstream_node_E}
	\end{minipage}
\end{figure}

\noindent
Equation \eqref{eq:uds_e_initial} can be expressed in a more compact fashion as
follows,
\begin{equation} \label{eq:uds_e}
	\dot{m}_e (\phi_e - \phi_P) = \frac{\dot{m}_e - \abs{\dot{m}_e}}{2} (\phi_E - \phi_P)
\end{equation}
since the approximation to compute $\dot{m}_e$ is related to $(\vb{v} \vdot
\vb{n})_e$ through the relation $\dot{m}_e = (\vb{v} \vdot \vb{n})_e S_{Pe}$.
The extension of \eqref{eq:uds_e} to the remaining faces is the following:
\begin{align}	
	\dot{m}_w (\phi_w - \phi_P) &= \frac{\dot{m}_w + \abs{\dot{m}_w}}{2} (\phi_W - \phi_P) \\
	\dot{m}_n (\phi_n - \phi_P) &= \frac{\dot{m}_n - \abs{\dot{m}_n}}{2} (\phi_N - \phi_P) \\
	\dot{m}_s (\phi_s - \phi_P) &= \frac{\dot{m}_s + \abs{\dot{m}_s}}{2} (\phi_S - \phi_P) \label{eq:uds_s}
\end{align} 


UDS is a stable scheme, however it suffers from numerical diffusion. Indeed,
assuming the upstream node is $P$, expanding $\phi$ about point $x_P$ in its
Taylor expansion up to $2^\text{nd}$ degree and using Lagrange's remainder,
\begin{equation} \label{eq:UDS_taylor_polynomial_P}
	\phi_e = 
	\phi_P + \left(\pdv{\phi}{x}\right)_P d_{Pe} + 
	\left(\pdv[2]{\phi}{x}\right)_{\xi_1} \frac{d_{Pe}^2}{2}
\end{equation}
it is apparent that UDS retains the first term on the left--hand side of
\eqref{eq:UDS_taylor_polynomial_P}. As a consequence, the error highest order is
$(\partial_x \phi)_P d_{Pe}$, which is proportional to the distance between $P$
and the face $\cs{Pe}$. This term resembles to a diffusion flux given, for
instance, by Fourier's or Fick's laws of diffusion. The same result is obtained
when $E$ is the upstream node,
\begin{equation}
	\phi_e = 
	\phi_E - \left(\pdv{\phi}{x}\right)_E d_{Ee} + \left(\pdv[2]{\phi}{x}\right)_{\xi_2} \frac{d_{Ee}^2}{2}
\end{equation}
whence it can be deduced that the error is bounded by $\max\{ \abs{(\partial_x
\phi)_E d_{Pe}}, \abs{(\partial_x \phi)_E d_{Ee}}\}$. The numerical diffusion
issue is magnified in multidimensional problems, where peaks of rapid variation
can be obtained, hence very fine grids are required. 